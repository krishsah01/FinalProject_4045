<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - RoomieRadar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body class="bg-light d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center fw-bold text-primary" href="#">
                <div class="bg-primary text-white rounded p-1 me-2 d-flex align-items-center justify-content-center"
                    style="width: 32px; height: 32px;">
                    <i class="bi bi-house-heart-fill"></i>
                </div>
                RoomieRadar
            </a>
            <a href="/login" class="btn btn-outline-primary btn-sm">Log In</a>
        </div>
    </nav>

    <div class="container flex-grow-1 d-flex align-items-center justify-content-center py-5">
        <div class="card shadow-lg border-0" style="max-width: 550px; width: 100%;">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <h1 class="h3 mb-2 fw-bold">Create an account</h1>
                    <p class="text-muted">Join RoomieRadar to manage your household</p>
                </div>

                <div th:if="${error}" class="alert alert-danger d-flex align-items-center" role="alert">
                    <i class="bi bi-exclamation-circle-fill me-2"></i>
                    <span th:text="${error}">Error occurred</span>
                </div>

                <form th:action="@{/auth/signup}" method="post" id="signupForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username"
                            placeholder="Choose a username" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email"
                            required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" name="password"
                            placeholder="Create a password" required>
                    </div>

                    <div class="mb-4">
                        <label class="form-label d-block">Household</label>
                        <div class="btn-group w-100" role="group" aria-label="Household options">
                            <input type="radio" class="btn-check" name="householdAction" value="join" id="joinHousehold"
                                checked>
                            <label class="btn btn-outline-primary" for="joinHousehold">Join Existing</label>

                            <input type="radio" class="btn-check" name="householdAction" value="create"
                                id="createHousehold">
                            <label class="btn btn-outline-primary" for="createHousehold">Create New</label>

                            <input type="radio" class="btn-check" name="householdAction" value="skip"
                                id="skipHousehold">
                            <label class="btn btn-outline-primary" for="skipHousehold">Skip</label>
                        </div>
                    </div>

                    <div id="joinHouseholdFields" class="card bg-light border-0 mb-3">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="householdId" class="form-label">Select Household</label>
                                <select id="householdId" name="householdId" class="form-select">
                                    <option value="">-- Select a household --</option>
                                    <option th:each="household : ${households}" th:value="${household.id}"
                                        th:text="${household.name}" th:attr="data-name=${household.name}">
                                    </option>
                                </select>
                            </div>
                            <input type="hidden" id="householdName" name="householdName">
                            <div class="mb-0">
                                <label for="householdPassword" class="form-label">Household Password</label>
                                <input type="password" class="form-control" id="householdPassword"
                                    name="householdPassword" placeholder="Enter household password">
                            </div>
                        </div>
                    </div>

                    <div id="createHouseholdFields" class="card bg-light border-0 mb-3" style="display: none;">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="newHouseholdName" class="form-label">Household Name</label>
                                <input type="text" class="form-control" id="newHouseholdName" name="newHouseholdName"
                                    placeholder="Enter new household name">
                            </div>
                            <div class="mb-0">
                                <label for="newHouseholdPassword" class="form-label">Household Password</label>
                                <input type="password" class="form-control" id="newHouseholdPassword"
                                    name="newHouseholdPassword" placeholder="Create household password">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2 mb-3">Sign up</button>

                    <div class="text-center small text-muted">
                        By signing up, you agree to our <a href="#" class="text-decoration-none">Terms of Service</a>
                        and <a href="#" class="text-decoration-none">Privacy Policy</a>
                    </div>
                </form>

                <script>
                    // Handle household action radio buttons
                    document.querySelectorAll('input[name="householdAction"]').forEach(radio => {
                        radio.addEventListener('change', function () {
                            document.getElementById('joinHouseholdFields').style.display = 'none';
                            document.getElementById('createHouseholdFields').style.display = 'none';

                            if (this.value === 'join') {
                                document.getElementById('joinHouseholdFields').style.display = 'block';
                            } else if (this.value === 'create') {
                                document.getElementById('createHouseholdFields').style.display = 'block';
                            }
                        });
                    });

                    // Update hidden household name field when selection changes
                    document.getElementById('householdId').addEventListener('change', function () {
                        const selectedOption = this.options[this.selectedIndex];
                        document.getElementById('householdName').value = selectedOption.getAttribute('data-name') || '';
                    });

                    // Form validation
                    document.getElementById('signupForm').addEventListener('submit', function (e) {
                        const action = document.querySelector('input[name="householdAction"]:checked').value;

                        if (action === 'join') {
                            const householdId = document.getElementById('householdId').value;
                            const householdPassword = document.getElementById('householdPassword').value;

                            if (!householdId || !householdPassword) {
                                e.preventDefault();
                                alert('Please select a household and enter the password');
                                return false;
                            }
                        } else if (action === 'create') {
                            const newName = document.getElementById('newHouseholdName').value;
                            const newPassword = document.getElementById('newHouseholdPassword').value;

                            if (!newName || !newPassword) {
                                e.preventDefault();
                                alert('Please provide household name and password');
                                return false;
                            }
                        }
                    });
                </script>

                <div class="text-center mt-4">
                    <p class="small text-muted mb-0">Already have an account? <a href="/login"
                            class="text-primary text-decoration-none fw-semibold">Log in</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>